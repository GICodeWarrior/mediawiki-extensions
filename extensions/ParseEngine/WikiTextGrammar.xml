<?xml version="1.0"?>
<Grammar rootTag="root" startRule="start" version="1.0">
	<Sequence name="start" >
		<Reference name="postNewLine" />
		<Reference name="main" />
	</Sequence>
	<Text name="main">
		<Choice>
			<Sequence>
				<Reference name="newLine" />
				<Reference name="postNewLine" />
			</Sequence>
			<Assignment tagName="link" tag="[[">
				<Reference name="endText" var="]]" />
			</Assignment>
			<Assignment tagName="tplArg" tag="{{{(?!{)" regex="true">
				<Sequence>
					<Reference name="name" />
					<Choice failSafe="true">
						<Assignment tagName="default" tag="|">
							<Reference name="main" />
						</Assignment>
					</Choice>
					<Assignment tagName="endTag" tag="}}}" />
				</Sequence>
			</Assignment>
			<Assignment tagName="template" tag="{{">
				<Sequence>
					<Reference name="name" />
					<Choice failSafe="true">
						<Assignment tagName="name2" tag=":">
							<Reference name="main" />
						</Assignment>
					</Choice>
					<Reference name="partList" />
					<Assignment tagName="endTag" tag="}}" />
				</Sequence>
			</Assignment>
			<Reference name="comment" />
			<Assignment tagName="noWiki" tag="&lt;nowiki>">
				<Sequence>
					<Text />
					<Assignment tagName="endTag" tag="&lt;\/nowiki>" />
				</Sequence>
			</Assignment>
			<Assignment tagName="xmlTag" tag="&lt;(?=(\w+)[\s\/>])" regex="true">
				<Sequence>
					<Assignment tagName="name" tag="~r" />
					<Reference name="attrList" />
					<Choice>
						<Assignment tagName="endTag" tag="\s*\/>" regex="true" />
						<Sequence>
							<Assignment tagName="inner" tag="\s*>" regex="true">
								<Reference name="main" />
							</Assignment>
							<Assignment tagName="endTag" tag="&lt;/~r>" />
						</Sequence>
					</Choice>
				</Sequence>
			</Assignment>
		</Choice>
	</Text>
	<Sequence name="endText">
		<Reference name="main" />
		<Assignment tagName="endTag" tag="~r" />
	</Sequence>
	<Assignment name="newLine" tagName="newLine" tag="\r?\n" regex="true" />
	<Assignment name="eol" tagName="eol" tag="(?=\n|$)" regex="true" />
	<Choice name="ignoreList" failSafe="true">
		<Sequence>
			<Choice>
				<Assignment tag="[ \t]+" regex="true" />
				<Reference name="comment" />
			</Choice>
			<Reference name="ignoreList" />
		</Sequence>
	</Choice>
	<Choice name="postNewLine" failSafe="true">
		<Sequence>
			<Assignment tagName="h" tag="(={1,6})" regex="true">
				<Reference name="endText" />
			</Assignment>
			<Reference name="ignoreList" />
			<Reference name="eol" />
		</Sequence>
		<Reference name="listChoice" var="" />
	</Choice>
	<Choice name="listChoice">
		<Assignment tagName="orderedList" tag="(?=(~r#))" regex="true">
			<Reference name="itemList" />
		</Assignment>
		<Assignment tagName="unorderedList" tag="(?=(~r\*))" regex="true">
			<Reference name="itemList" />
		</Assignment>
	</Choice>
	<Sequence name="itemList">
		<Choice>
			<Reference name="listChoice" />
			<Assignment tagName="listItem" tag="~r">
				<Sequence>
					<Reference name="main" />
					<Reference name="eol" />
				</Sequence>
			</Assignment>
		</Choice>
		<Choice failSafe="true">
			<Sequence>
				<Reference name="newLine" />
				<Reference name="itemList" />
			</Sequence>
		</Choice>
	</Sequence>
	<Assignment name="comment" tagName="comment" tag="&lt;!--.*?(?:-->|$)" regex="true" />
	<Assignment name="name" tagName="name">
		<Reference name="main" />
	</Assignment>
	<Choice name="partList" failSafe="true">
		<Sequence>
			<Assignment tagName="part" tag="|">
				<Sequence>
					<Reference name="name" />
					<Choice failSafe="true">
						<Assignment tagName="value" tag="=">
							<Reference name="main" />
						</Assignment>
					</Choice>
				</Sequence>
			</Assignment>
			<Reference name="partList" />
		</Sequence>
	</Choice>
	<Choice name="attrList" failSafe="true">
		<Sequence>
			<Assignment tagName="attribute" tag="\s+(?!\/?>)" regex="true">
				<Sequence>
					<Reference name="name" />
					<Assignment tagName="value" tag="\s*=\s*(&quot;|')" regex="true">
						<Reference name="endText" />
					</Assignment>
				</Sequence>
			</Assignment>
			<Reference name="attrList" />
		</Sequence>
	</Choice>
</Grammar>
