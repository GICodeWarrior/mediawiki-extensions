Description: fix restrictions bypass via incorrect session data handling
Origin: upstream, http://svn.php.net/viewvc?view=revision&revision=291681

diff -Nur php5-5.2.4/ext/session/session.c php5-5.2.4.new/ext/session/session.c
--- php5-5.2.4/ext/session/session.c	2010-01-06 09:38:45.000000000 -0500
+++ php5-5.2.4.new/ext/session/session.c	2010-01-06 09:38:50.000000000 -0500
@@ -1725,7 +1725,10 @@
 	
 	convert_to_string_ex(p_name);
 	
-	PS_DEL_VARL(Z_STRVAL_PP(p_name), Z_STRLEN_PP(p_name));
+ 	IF_SESSION_VARS() {
+ 		SEPARATE_ZVAL_IF_NOT_REF(&PS(http_session_vars));
+ 		PS_DEL_VARL(Z_STRVAL_PP(p_name), Z_STRLEN_PP(p_name));
+ 	}
 
 	RETURN_TRUE;
 }
@@ -1835,7 +1838,10 @@
 		RETURN_FALSE;
 
 	IF_SESSION_VARS() {
-		HashTable *ht = Z_ARRVAL_P(PS(http_session_vars));
+		HashTable *ht;
+
+		SEPARATE_ZVAL_IF_NOT_REF(&PS(http_session_vars));
+		ht = Z_ARRVAL_P(PS(http_session_vars));
 
 		if (PG(register_globals)) {
 			uint str_len;
