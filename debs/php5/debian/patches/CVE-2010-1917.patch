Description: fix denial of service via fnmatch stack consumption
Origin: upstream, http://svn.php.net/viewvc?view=revision&revision=298881

diff -Nur php5-5.2.4/ext/standard/file.c php5-5.2.4.new/ext/standard/file.c
--- php5-5.2.4/ext/standard/file.c	2010-09-15 08:27:53.000000000 -0400
+++ php5-5.2.4.new/ext/standard/file.c	2010-09-15 08:27:56.000000000 -0400
@@ -2526,6 +2526,10 @@
 		php_error_docref(NULL TSRMLS_CC, E_WARNING, "Filename exceeds the maximum allowed length of %d characters", MAXPATHLEN);
 		RETURN_FALSE;
 	}
+	if (pattern_len >= MAXPATHLEN) {
+		php_error_docref(NULL TSRMLS_CC, E_WARNING, "Pattern exceeds the maximum allowed length of %d characters", MAXPATHLEN);
+		RETURN_FALSE;
+	}
 
 	RETURN_BOOL( ! fnmatch( pattern, filename, flags ));
 }
