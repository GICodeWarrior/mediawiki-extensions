Description: fix weak entropy in Linear Congruential Generator (LCG)
Origin: upstream, http://svn.php.net/viewvc?view=revision&revision=293253

diff -Nur php5-5.2.4/ext/standard/lcg.c php5-5.2.4.new/ext/standard/lcg.c
--- php5-5.2.4/ext/standard/lcg.c	2007-05-17 02:38:13.000000000 -0400
+++ php5-5.2.4.new/ext/standard/lcg.c	2010-09-15 08:27:10.000000000 -0400
@@ -78,7 +78,7 @@
 	struct timeval tv;
 
 	if (gettimeofday(&tv, NULL) == 0) {
-		LCG(s1) = tv.tv_sec ^ (~tv.tv_usec);
+		LCG(s1) = tv.tv_sec ^ (tv.tv_usec<<11);
 	} else {
 		LCG(s1) = 1;
 	}
@@ -88,6 +88,11 @@
 	LCG(s2) = (long) getpid();
 #endif
 
+	/* Add entropy to s2 by calling gettimeofday() again */
+	if (gettimeofday(&tv, NULL) == 0) {
+		LCG(s2) ^= (tv.tv_usec<<11);
+	}
+
 	LCG(seeded) = 1;
 }
 
