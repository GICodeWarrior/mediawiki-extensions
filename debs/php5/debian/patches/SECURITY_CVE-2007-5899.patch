diff -Nur php5-5.2.4/ext/standard/url_scanner_ex.c php5-5.2.4.new/ext/standard/url_scanner_ex.c
--- php5-5.2.4/ext/standard/url_scanner_ex.c	2007-08-29 19:39:22.000000000 -0400
+++ php5-5.2.4.new/ext/standard/url_scanner_ex.c	2008-07-10 16:28:59.000000000 -0400
@@ -259,16 +259,29 @@
 
 	if (ctx->form_app.len > 0) {
 		switch (ctx->tag.len) {
-
-#define RECOGNIZE(x) do { 	\
-	case sizeof(x)-1: \
-		if (strncasecmp(ctx->tag.c, x, sizeof(x)-1) == 0) \
-			doit = 1; \
-		break; \
-} while (0)
-		
-			RECOGNIZE("form");
-			RECOGNIZE("fieldset");
+			case sizeof("form") - 1:
+				if (!strncasecmp(ctx->tag.c, "form", sizeof("form") - 1)) {
+					doit = 1;		
+				}
+				if (doit && ctx->val.c && ctx->lookup_data && *ctx->lookup_data) {
+					char *e, *p = zend_memnstr(ctx->val.c, "://", sizeof("://") - 1, ctx->val.c + ctx->val.len);
+					if (p) {
+						e = memchr(p, '/', (ctx->val.c + ctx->val.len) - p);
+						if (!e) {
+							e = ctx->val.c + ctx->val.len;
+						}
+						if ((e - p) && strncasecmp(p, ctx->lookup_data, (e - p))) {
+							doit = 0;
+						}
+					}
+				}
+				break;
+
+			case sizeof("fieldset") - 1:
+				if (!strncasecmp(ctx->tag.c, "fieldset", sizeof("fieldset") - 1)) {
+					doit = 1;		
+				}
+				break;
 		}
 
 		if (doit)
@@ -276,8 +289,6 @@
 	}
 }
 
-
-
 /*
  *  HANDLE_TAG copies the HTML Tag and checks whether we 
  *  have that tag in our table. If we might modify it,
diff -Nur php5-5.2.4/ext/standard/url_scanner_ex.re php5-5.2.4.new/ext/standard/url_scanner_ex.re
--- php5-5.2.4/ext/standard/url_scanner_ex.re	2007-06-05 20:00:27.000000000 -0400
+++ php5-5.2.4.new/ext/standard/url_scanner_ex.re	2008-07-10 16:28:59.000000000 -0400
@@ -205,16 +205,29 @@
 
 	if (ctx->form_app.len > 0) {
 		switch (ctx->tag.len) {
-
-#define RECOGNIZE(x) do { 	\
-	case sizeof(x)-1: \
-		if (strncasecmp(ctx->tag.c, x, sizeof(x)-1) == 0) \
-			doit = 1; \
-		break; \
-} while (0)
-		
-			RECOGNIZE("form");
-			RECOGNIZE("fieldset");
+			case sizeof("form") - 1:
+				if (!strncasecmp(ctx->tag.c, "form", sizeof("form") - 1)) {
+					doit = 1;		
+				}
+				if (doit && ctx->val.c && ctx->lookup_data && *ctx->lookup_data) {
+					char *e, *p = zend_memnstr(ctx->val.c, "://", sizeof("://") - 1, ctx->val.c + ctx->val.len);
+					if (p) {
+						e = memchr(p, '/', (ctx->val.c + ctx->val.len) - p);
+						if (!e) {
+							e = ctx->val.c + ctx->val.len;
+						}
+						if ((e - p) && strncasecmp(p, ctx->lookup_data, (e - p))) {
+							doit = 0;
+						}
+					}
+				}
+				break;
+
+			case sizeof("fieldset") - 1:
+				if (!strncasecmp(ctx->tag.c, "fieldset", sizeof("fieldset") - 1)) {
+					doit = 1;		
+				}
+				break;
 		}
 
 		if (doit)
@@ -222,8 +235,6 @@
 	}
 }
 
-
-
 /*
  *  HANDLE_TAG copies the HTML Tag and checks whether we 
  *  have that tag in our table. If we might modify it,
