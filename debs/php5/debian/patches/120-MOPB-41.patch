diff -uNrp php5-5.2.1.orig/ext/sqlite/sess_sqlite.c php5-5.2.1/ext/sqlite/sess_sqlite.c
--- php5-5.2.1.orig/ext/sqlite/sess_sqlite.c	2007-01-01 01:36:07.000000000 -0800
+++ php5-5.2.1/ext/sqlite/sess_sqlite.c	2007-04-23 15:45:35.000000000 -0700
@@ -31,6 +31,11 @@
 extern int sqlite_encode_binary(const unsigned char *in, int n, unsigned char *out);
 extern int sqlite_decode_binary(const unsigned char *in, unsigned char *out);
 
+#define php_sqlite_decode_binary(in, out)    (	\
+	(!in || !*in) ? 0 : \
+		sqlite_decode_binary((const unsigned char *)in, (unsigned char *)out) \
+)
+
 PS_FUNCS(sqlite);
 
 ps_module ps_mod_sqlite = {
@@ -111,7 +116,7 @@ PS_READ_FUNC(sqlite) 
 			if (rowdata[0] != NULL) {
 				*vallen = strlen(rowdata[0]);
 				*val = emalloc(*vallen);
-				*vallen = sqlite_decode_binary(rowdata[0], *val);
+				*vallen = php_sqlite_decode_binary(rowdata[0], *val);
 				(*val)[*vallen] = '\0';
 			}
 			break;
diff -uNrp php5-5.2.1.orig/ext/sqlite/sqlite.c php5-5.2.1/ext/sqlite/sqlite.c
--- php5-5.2.1.orig/ext/sqlite/sqlite.c	2007-01-01 01:36:07.000000000 -0800
+++ php5-5.2.1/ext/sqlite/sqlite.c	2007-04-23 15:45:35.000000000 -0700
@@ -73,7 +73,10 @@ extern int sqlite_encode_binary(const un
 extern int sqlite_decode_binary(const unsigned char *in, unsigned char *out);
 
 #define php_sqlite_encode_binary(in, n, out) sqlite_encode_binary((const unsigned char *)in, n, (unsigned char *)out)
-#define php_sqlite_decode_binary(in, out)    sqlite_decode_binary((const unsigned char *)in, (unsigned char *)out)
+#define php_sqlite_decode_binary(in, out)    (	\
+	(!in || !*in) ? 0 : \
+		sqlite_decode_binary((const unsigned char *)in, (unsigned char *)out) \
+)
 
 static int sqlite_count_elements(zval *object, long *count TSRMLS_DC);
 
