<?
include ( "./specialPages.php" ) ;
include ( "./databaseFunctions.php" ) ;
include ( "./wikiTitle.php" ) ;
include ( "./wikiPage.php" ) ;
include ( "./wikiUser.php" ) ;

# Main program
	global $action , $title , $pageTitle ;
	global $user , $search ;
	$pageTitle = "" ;
	$user = new WikiUser ;
	$user->scanCookies () ;
	if ( $action == "" ) $action = "view" ;
	if ( $title == "" ) $title = "HomePage" ;
	
	$action = strtolower ( trim ( $action ) ) ;
	$title = urldecode ( $title ) ;

	if ( isset ( $search ) ) {
		$out = doSearch () ;
		unset ( $search ) ;
	} else  if ( $action == "watch" ) {
		global $mode ;
		$out = watch ( $title , $mode ) ;
	} else if ( $action == "view" ) $out = view ( $title ) ;
	else if ( $action == "edit" ) $out = doEdit ( $title ) ;
	else if ( $action == "history" ) $out = doHistory ( $title ) ;
	else $out = error ( "No such action \"$action\"" ) ;

	global $bodyOptions , $headerScript ;
	$pageTitle = "Wikipedia : ".$pageTitle ;
	$bodyOptions .= $user->options["background"] ;
	$bodyOptions .= $user->options["text"] ;
	$head = "<HTML><HEAD><TITLE>$pageTitle</TITLE> $headerScript </HEAD><BODY $bodyOptions>\n" ;
	$tail = "</BODY></HTML>" ;

	$linkStyle = "style=\"color:blue\"" ;
	if ( $user->options["underlineLinks"] == "no" ) $linkStyle = "style=\"color:blue;text-decoration:none\"" ;
	if ( $user->options["forceLinks"] != "" ) $linkStyle = $user->options["forceLinks"] ;
	$out = str_replace ( "<a href=" , "<a $linkStyle href=" , $out ) ;
	$out = str_replace ( "&lt;a style=\"color:blue\"" , "&lt;a " , $out ) ; # Correcting weird replacement above

	global $append; # For testing
	print $head.$out.$tail.$append ;
?>